# Video Processing: Frames + Audio Strategy

## –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

–ê–Ω–∞–ª–∏–∑ –≤–∏–¥–µ–æ –∫–∞–∫ **–Ω–∞–±–æ—Ä–∞ –∫–∞–¥—Ä–æ–≤ + –∞—É–¥–∏–æ–¥–æ—Ä–æ–∂–∫–∏** —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π —Ä–∞–∑–º–µ—Ä–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏.

**–¶–µ–ª—å:** –≠–∫–æ–Ω–æ–º–∏—è —Å—Ä–µ–¥—Å—Ç–≤ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –≤–∏–¥–µ–æ –ø—É—Ç–µ–º:

- –ì–∏–±–∫–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–∑–≤–ª–µ–∫–∞–µ–º—ã—Ö –∫–∞–¥—Ä–æ–≤ (3 —Ä–µ–∂–∏–º–∞ –∫–∞–∫ –≤ GIF)
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –∏ —Ä–∞–∑–º–µ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (WEBP, 1080p –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–≥–æ —Å–∂–∞—Ç–∏—è –∞—É–¥–∏–æ (Vorbis mono 64/32/24 kbps)
- –û—Ç–ø—Ä–∞–≤–∫–∏ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –≤ **–æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ** –∫ Gemini API
- **In-memory –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏** –±–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

**–ö–ª—é—á–µ–≤–æ–π –≤–æ–ø—Ä–æ—Å:** –ú–æ–∂–Ω–æ –ª–∏ –º–∏–∫—Å–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –∞—É–¥–∏–æ –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ?
**–û—Ç–≤–µ—Ç:** –î–ê - Gemini –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ + –∞—É–¥–∏–æ inline.

**–õ–∏–º–∏—Ç Gemini:** 20 MB –Ω–∞ –≤–µ—Å—å inline request (–∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ `image_understanding.md`).

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è MVP

### 1. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–ë–∞–∑–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ (–ø—Ä–æ—Å—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞):**

```txt
# requirements.txt
imageio-ffmpeg>=0.5.0    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π ffmpeg –±–∏–Ω–∞—Ä–Ω–∏–∫
pillow>=10.0.0           # WEBP –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (—É–∂–µ –µ—Å—Ç—å)
pydub>=0.25.1            # –ê—É–¥–∏–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- `pip install` —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- –ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å (Win/Mac/Linux)
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ~10-15 MB –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

**–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (–¥–ª—è –±—É–¥—É—â–µ–≥–æ):**

- –ê–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ ffmpeg (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ–ª–µ–µ —Å–≤–µ–∂–µ–π –≤–µ—Ä—Å–∏–∏
- –°–∫—Ä–∏–ø—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –û–°

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤

#### –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: WEBP + —É–º–Ω—ã–π resize

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã Gemini:**

- PNG (`image/png`)
- JPEG (`image/jpeg`)
- **WEBP (`image/webp`)** ‚Üê –û—Å–Ω–æ–≤–Ω–æ–π –≤—ã–±–æ—Ä
- HEIC (`image/heic`)
- HEIF (`image/heif`)

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è MVP:**

- **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:** 1080p WEBP quality 80
- **–õ–æ–≥–∏–∫–∞ resize:** –ï—Å–ª–∏ –∫–∞–¥—Ä >= 1080p ‚Üí —Å–∂–∞—Ç—å –¥–æ 1080p, –∏–Ω–∞—á–µ —Å–∂–∞—Ç—å –¥–æ 1080p –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
- **–§–æ—Ä–º–∞—Ç:** –í—Å–µ–≥–¥–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ WEBP (–¥–∞–∂–µ –µ—Å–ª–∏ –∏—Å—Ç–æ—á–Ω–∏–∫ PNG/JPEG)
- **In-memory:** –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –±–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (–∫–∞–∫ –≤ `gif_processor.py`)

**–ü–æ—á–µ–º—É WEBP:**

- **–ù–∞ 25-35% –º–µ–Ω—å—à–µ** —Ä–∞–∑–º–µ—Ä —á–µ–º JPEG –ø—Ä–∏ —Ç–æ–º –∂–µ –∫–∞—á–µ—Å—Ç–≤–µ
- –ù–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Gemini
- Pillow –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏

**–¢–∞–±–ª–∏—Ü–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ –∫–∞–¥—Ä–∞ WEBP quality 80:**

| –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ | –†–∞–∑–º–µ—Ä/–∫–∞–¥—Ä | 10 –∫–∞–¥—Ä–æ–≤ | 30 –∫–∞–¥—Ä–æ–≤ | 60 –∫–∞–¥—Ä–æ–≤ |
|------------|-------------|-----------|-----------|----------|
| 1080p | ~100 KB | 1 MB | 3 MB | 6 MB |
| 720p | ~50 KB | 0.5 MB | 1.5 MB | 3 MB |
| 480p | ~25 KB | 0.25 MB | 0.75 MB | 1.5 MB |

#### –ê—É–¥–∏–æ: Vorbis mono —Å –≤—ã–±–æ—Ä–æ–º –±–∏—Ç—Ä–µ–π—Ç–∞

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è MVP:**

- **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:** 64 kbps mono Vorbis
- **–û–ø—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:** 64, 32, 24 kbps
- **–§–æ—Ä–º–∞—Ç:** Vorbis (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä OGG) - –ª—É—á—à–µ —Å–∂–∞—Ç–∏–µ —á–µ–º MP3
- **Mono –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:** 2x —ç–∫–æ–Ω–æ–º–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ stereo
- **In-memory:** –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ BytesIO –±–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

**–¢–∞–±–ª–∏—Ü–∞ –±–∏—Ç—Ä–µ–π—Ç–æ–≤ (mono Vorbis):**

| –ë–∏—Ç—Ä–µ–π—Ç | –ö–∞—á–µ—Å—Ç–≤–æ | –†–∞–∑–º–µ—Ä/–º–∏–Ω—É—Ç–∞ | 10 –º–∏–Ω—É—Ç | 30 –º–∏–Ω—É—Ç | 180 –º–∏–Ω—É—Ç (3—á) |
|---------|----------|---------------|----------|----------|----------------|
| **64 kbps** | –û—Ç–ª–∏—á–Ω–æ –¥–ª—è —Ä–µ—á–∏ + –º—É–∑—ã–∫–∞ | 0.48 MB | 4.8 MB | **14.4 MB** | 86 MB |
| **32 kbps** | –•–æ—Ä–æ—à–æ –¥–ª—è —Ä–µ—á–∏ | 0.24 MB | 2.4 MB | **7.2 MB** | 43 MB |
| **24 kbps** | –ù–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è —Ä–µ—á–∏ | 0.18 MB | 1.8 MB | **5.4 MB** | 32 MB |

**–û—Å—Ç–∞—Ç–æ–∫ –¥–ª—è –∫–∞–¥—Ä–æ–≤ –ø—Ä–∏ –ª–∏–º–∏—Ç–µ 20 MB:**

- 64 kbps (30 –º–∏–Ω): ~5.6 MB –Ω–∞ –∫–∞–¥—Ä—ã ‚Üí ~50 –∫–∞–¥—Ä–æ–≤ 1080p
- 32 kbps (30 –º–∏–Ω): ~12.8 MB –Ω–∞ –∫–∞–¥—Ä—ã ‚Üí ~120 –∫–∞–¥—Ä–æ–≤ 1080p ‚úÖ **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –±–∞–ª–∞–Ω—Å**
- 24 kbps (30 –º–∏–Ω): ~14.6 MB –Ω–∞ –∫–∞–¥—Ä—ã ‚Üí ~140 –∫–∞–¥—Ä–æ–≤ 1080p

### 3. –õ–∏–º–∏—Ç—ã Gemini API

**–ò–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ [`image_understainding.md`](../gem/image_understainding.md):**

- **Inline data –ª–∏–º–∏—Ç:** 20 MB (—Ç–µ–∫—Å—Ç + –ø—Ä–æ–º–ø—Ç—ã + –≤—Å–µ –º–µ–¥–∏–∞)
- **–ú–∞–∫—Å–∏–º—É–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:** 3,600 –Ω–∞ –∑–∞–ø—Ä–æ—Å
- **–ú–æ–∂–Ω–æ –º–∏–∫—Å–æ–≤–∞—Ç—å:** –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è + –∞—É–¥–∏–æ –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ

**–í—ã–≤–æ–¥:** –î–ª—è 30-–º–∏–Ω—É—Ç–Ω–æ–≥–æ –≤–∏–¥–µ–æ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –≤–ª–µ–∑–∞–µ–º –≤ –ª–∏–º–∏—Ç—ã:

- 10 –∫–∞–¥—Ä–æ–≤ √ó 70 KB WEBP = **0.7 MB**
- –ê—É–¥–∏–æ 30 –º–∏–Ω Vorbis = **12 MB**
- **–ò—Ç–æ–≥–æ: ~12.7 MB** ‚úÖ (–æ—Å—Ç–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å)

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ MVP

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π

```
utils/
‚îú‚îÄ‚îÄ media_frame_extractor.py  # –ù–û–í–´–ô: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –¥–ª—è GIF + Video
‚îÇ   ‚îú‚îÄ‚îÄ extract_frames()      # –†–∞–±–æ—Ç–∞–µ—Ç —Å GIF –∏ Video
‚îÇ   ‚îú‚îÄ‚îÄ resize_image()        # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑ gif_processor
‚îÇ   ‚îî‚îÄ‚îÄ convert_to_webp()     # In-memory –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ audio_extractor.py        # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∞—É–¥–∏–æ
‚îÇ   ‚îú‚îÄ‚îÄ extract_audio()       # In-memory —á–µ—Ä–µ–∑ BytesIO
‚îÇ   ‚îî‚îÄ‚îÄ estimate_audio_size() # –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –±–µ–∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
‚îÇ
‚îî‚îÄ‚îÄ gif_processor.py          # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π - –ù–ï –º–µ–Ω—è–µ–º
    ‚îî‚îÄ‚îÄ (–ª–æ–≥–∏–∫–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)

tools/
‚îî‚îÄ‚îÄ video_analyzer.py         # MCP tool –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤–∏–¥–µ–æ
    ‚îú‚îÄ‚îÄ analyze_video()       # –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥
    ‚îî‚îÄ‚îÄ estimate_request_size() # Dry-run –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞

models/
‚îî‚îÄ‚îÄ analysis.py               # + VideoAnalysisResponse
```

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**

1. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –õ–æ–≥–∏–∫–∞ `gif_processor` –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –≤–∏–¥–µ–æ
2. **In-memory:** –í—Å–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ BytesIO/PIL –±–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
3. **Dry-run:** –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞ –ë–ï–ó —Ä–µ–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. `utils/media_frame_extractor.py` (–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

- **–¢—Ä–∏ —Ä–µ–∂–∏–º–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è** (–∫–∞–∫ –≤ `gif_processor.py`):
  - `mode="total"` - N –∫–∞–¥—Ä–æ–≤ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ –ø–æ –≤—Å–µ–º—É –≤–∏–¥–µ–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  - `mode="fps"` - X –∫–∞–¥—Ä–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
  - `mode="interval"` - –∫–∞–¥—Ä –∫–∞–∂–¥—ã–µ X —Å–µ–∫—É–Ω–¥
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ PIL.Image
- Resize –¥–æ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1080p)
- **In-memory –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è** –≤ WEBP —á–µ—Ä–µ–∑ BytesIO
- –í–æ–∑–≤—Ä–∞—Ç base64 –±–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

**API:**

```python
def extract_frames(
    source: str | Image.Image,  # Video path –∏–ª–∏ GIF Image
    mode: Literal["fps", "total", "interval"] = "total",
    
    # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞
    frame_count: Optional[int] = 10,  # –î–ª—è mode="total"
    fps: Optional[float] = None,      # –î–ª—è mode="fps"
    interval_sec: Optional[float] = None,  # –î–ª—è mode="interval"
    
    # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞—á–µ—Å—Ç–≤–∞
    max_dimension: int = 1080,  # 1080p –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    output_format: Literal["webp", "jpeg", "png"] = "webp",
    quality: int = 80
) -> tuple[list[str], dict]:
    """Extract and optimize frames from video or GIF.
    
    Returns:
        (frames_base64, metadata)
        metadata = {
            'frame_count': int,
            'total_size_mb': float,
            'avg_frame_size_kb': float,
            'resolution': str  # e.g., "1920x1080"
        }
    """
```

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç:** `imageio-ffmpeg` –¥–ª—è –≤–∏–¥–µ–æ, —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –¥–ª—è GIF

#### 2. `utils/audio_extractor.py`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞—É–¥–∏–æ–¥–æ—Ä–æ–∂–∫–∏ –∏–∑ –≤–∏–¥–µ–æ
- **In-memory –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è** –≤ mono Vorbis —á–µ—Ä–µ–∑ BytesIO
- –í—ã–±–æ—Ä –±–∏—Ç—Ä–µ–π—Ç–∞ (64/32/24 kbps)
- –û–±—Ä–µ–∑–∫–∞ –ø–æ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ë–ï–ó –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏

**API:**

```python
def extract_audio_from_video(
    video_path: str,
    bitrate: Literal[64, 32, 24] = 64,  # kbps
    max_duration_sec: Optional[int] = None,  # –û–±—Ä–µ–∑–∞—Ç—å –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    dry_run: bool = False  # –¢–æ–ª—å–∫–æ —Ä–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞
) -> dict:
    """Extract and optimize audio track (in-memory).
    
    Returns:
        {
            'base64': str,          # –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ dry_run=False
            'mime_type': 'audio/ogg',
            'duration_sec': float,
            'size_mb': float,
            'bitrate': int,
            'channels': 1  # mono
        }
    """

def estimate_audio_size(
    duration_sec: float,
    bitrate: int = 64
) -> float:
    """–ë—ã—Å—Ç—Ä—ã–π —Ä–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞.
    
    Returns:
        Size in MB
    """
    return (duration_sec * bitrate * 1000 / 8) / (1024 * 1024)
```

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç:** `pydub` –ø–æ–≤–µ—Ä—Ö `imageio-ffmpeg`, –≤—Å–µ —á–µ—Ä–µ–∑ BytesIO

#### 3. `tools/video_analyzer.py`

**MCP Tool —Å –ø–æ–ª–Ω–æ–π –≥–∏–±–∫–æ—Å—Ç—å—é:**

```python
@mcp.tool()
async def analyze_video(
    video_path: str,
    prompt: str = "Analyze this video content",
    
    # Frame extraction modes (–ö–ê–ö –í GIF!)
    frame_mode: Literal["fps", "total", "interval"] = "total",
    frame_count: Optional[int] = 10,      # –î–ª—è mode="total"
    fps: Optional[float] = None,          # –î–ª—è mode="fps" (0.0167 = 1 –∫–∞–¥—Ä/–º–∏–Ω)
    interval_sec: Optional[float] = None, # –î–ª—è mode="interval"
    
    # Frame quality
    max_dimension: int = 1080,  # 1080p –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    image_format: Literal["webp", "jpeg"] = "webp",
    image_quality: int = 80,
    
    # Audio options
    include_audio: bool = True,
    audio_bitrate: Literal[64, 32, 24] = 64,  # kbps
    
    # Utility
    dry_run: bool = False,  # –¢–æ–ª—å–∫–æ —Ä–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞, –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞
    
    # Model
    model: str = DEFAULT_GEMINI_MODEL
) -> str:
    """Analyze video as frames + audio in one request.
    
    Args:
        frame_mode: –†–µ–∂–∏–º –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–∞–¥—Ä–æ–≤
            - "total": N –∫–∞–¥—Ä–æ–≤ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
            - "fps": X –∫–∞–¥—Ä–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
            - "interval": –∫–∞–¥—Ä –∫–∞–∂–¥—ã–µ X —Å–µ–∫—É–Ω–¥
        dry_run: –ï—Å–ª–∏ True, –≤–µ—Ä–Ω–µ—Ç —Ç–æ–ª—å–∫–æ –æ—Ü–µ–Ω–∫—É —Ä–∞–∑–º–µ—Ä–∞ –±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏
    
    Returns:
        JSON —Å VideoAnalysisResponse –∏–ª–∏ (–µ—Å–ª–∏ dry_run) —Ä–∞–∑–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞
    """
```

**Workflow:**

1. **–ï—Å–ª–∏ dry_run=True:**
   - –ë—ã—Å—Ç—Ä–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∞–∑–º–µ—Ä—ã –∫–∞–¥—Ä–æ–≤ –∏ –∞—É–¥–∏–æ
   - –í–µ—Ä–Ω—É—Ç—å –æ—Ü–µ–Ω–∫—É –ë–ï–ó –æ–±—Ä–∞–±–æ—Ç–∫–∏
   - –ü–æ–∫–∞–∑–∞—Ç—å fits_in_limit (< 20 MB)

2. **–ò–Ω–∞—á–µ (–Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º):**
   - –ò–∑–≤–ª–µ—á—å –∫–∞–¥—Ä—ã ‚Üí WEBP base64 (in-memory)
   - –ò–∑–≤–ª–µ—á—å –∞—É–¥–∏–æ ‚Üí Vorbis base64 (in-memory)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä < 20 MB
   - –°–æ–±—Ä–∞—Ç—å `contents = [prompt, img1, img2, ..., audio]`
   - –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –∫ Gemini
   - –í–µ—Ä–Ω—É—Ç—å JSON —Å `VideoAnalysisResponse`

**–ü—Ä–∏–º–µ—Ä dry-run –æ—Ç–≤–µ—Ç–∞:**

```json
{
  "estimated_size_mb": 18.5,
  "fits_in_limit": true,
  "frames": {
    "count": 30,
    "mode": "total",
    "resolution": "1920x1080",
    "format": "webp",
    "total_size_mb": 3.0
  },
  "audio": {
    "duration_min": 30,
    "bitrate_kbps": 32,
    "size_mb": 7.2
  },
  "recommendation": "Safe to send (38% of 20 MB limit)"
}
```

#### 4. `models/analysis.py` (–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ)

```python
class VideoAnalysisResponse(BaseModel):
    """Structured response from video analysis."""
    
    visual_summary: str = Field(
        ..., 
        description="Summary of visual content across frames"
    )
    audio_transcription: Optional[str] = Field(
        default=None,
        description="Speech transcription from audio"
    )
    audio_description: Optional[str] = Field(
        default=None,
        description="Non-speech sounds (music, effects, ambient)"
    )
    combined_narrative: str = Field(
        ...,
        description="Unified story combining visual + audio"
    )
    key_moments: Optional[list[str]] = Field(
        default=None,
        description="Important events or timestamps"
    )
```

### –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏ —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–¥–∞

**–ß—Ç–æ –±–µ—Ä–µ–º –∏–∑ `gif_processor.py`:**

- ‚úÖ `resize_image()` - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ PIL.Image
- ‚úÖ `_get_total_indices()` - —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞–¥—Ä–æ–≤
- ‚úÖ `_get_fps_indices()` - –∫–∞–¥—Ä—ã –ø–æ FPS
- ‚úÖ `_get_interval_indices()` - –∫–∞–¥—Ä—ã —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–≤–∞–ª
- ‚úÖ `_convert_frame()` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è RGB/RGBA
- ‚úÖ In-memory –ø–æ–¥—Ö–æ–¥ —á–µ—Ä–µ–∑ PIL

**–ß—Ç–æ –±–µ—Ä–µ–º –∏–∑ `image_tokens.py`:**

- ‚úÖ `calculate_images_tokens()` - –æ—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∫–∞–¥—Ä–æ–≤
- ‚úÖ –§–æ—Ä–º—É–ª—ã —Ä–∞—Å—á–µ—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—é
- ‚úÖ –õ–æ–≥–∏–∫–∞ –ø–æ–¥—Å—á–µ—Ç–∞ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–ß—Ç–æ –±–µ—Ä–µ–º –∏–∑ `audio_analyzer.py`:**

- ‚úÖ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å inline audio base64
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è –∞—É–¥–∏–æ-–∞–Ω–∞–ª–∏–∑–∞
- ‚úÖ –§–æ—Ä–º–∞—Ç –≤–æ–∑–≤—Ä–∞—Ç–∞ AudioAnalysisResponse

**–ù–æ–≤–æ–µ:**

- üÜï –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π `media_frame_extractor` –¥–ª—è GIF + Video
- üÜï Dry-run —Ä–µ–∂–∏–º –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞
- üÜï In-memory –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∞—É–¥–∏–æ —á–µ—Ä–µ–∑ BytesIO
- üÜï –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ 20 MB –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è MVP

### –ß—Ç–æ –¥–µ–ª–∞–µ–º –≤ MVP (–≤–µ—Ä—Å–∏—è 1.0)

- ‚úÖ **–¢—Ä–∏ —Ä–µ–∂–∏–º–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–∞–¥—Ä–æ–≤** (–∫–∞–∫ –≤ GIF): `total`, `fps`, `interval`
- ‚úÖ **–ì–∏–±–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞:** 1080p/720p/480p, WEBP/JPEG, –±–∏—Ç—Ä–µ–π—Ç 64/32/24 kbps
- ‚úÖ **Dry-run —Ä–µ–∂–∏–º:** –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ë–ï–ó –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞:** –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ < 20 MB –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- ‚úÖ **In-memory –æ–±—Ä–∞–±–æ—Ç–∫–∞:** –ë–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ **–û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –∫ Gemini:** frames + audio –≤ `contents` array
- ‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç:** VideoAnalysisResponse —Å –≤–∏–∑—É–∞–ª–æ–º + –∞—É–¥–∏–æ
- ‚úÖ **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞:** –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Å `gif_processor`

### –ß—Ç–æ –ù–ï –¥–µ–ª–∞–µ–º (–≤ –≤–µ—Ä—Å–∏–∏ 2.0)

- ‚ùå –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–ª–∏–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ (>20 MB) –Ω–∞ —á–∞—Å—Ç–∏
- ‚ùå –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–ø—Ä–æ–º–ø—Ç –∫–µ—à Gemini)
- ‚ùå –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –∏—Å—Ç–æ—Ä–∏–µ–π —á–∞—Ç–∞
- ‚ùå –£–º–Ω—ã–π –≤—ã–±–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–∞–¥—Ä–æ–≤ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
- ‚ùå –î–µ—Ç–µ–∫—Ü–∏—è —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω
- ‚ùå –†–µ–∂–∏–º "—Ç–æ–ª—å–∫–æ –≤–∏–∑—É–∞–ª" –∏–ª–∏ "—Ç–æ–ª—å–∫–æ –∞—É–¥–∏–æ"
- ‚ùå –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–∞–¥—Ä–æ–≤ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º timestamp
- ‚ùå –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–∞–¥—Ä–æ–≤ "–¥–æ/–ø–æ—Å–ª–µ"

### –†–∞—Å—á–µ—Ç—ã –¥–ª—è —Ç–∏–ø–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

#### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ö–æ—Ä–æ—Ç–∫–æ–µ –¥–∏–Ω–∞–º–∏—á–Ω–æ–µ –≤–∏–¥–µ–æ (10 –º–∏–Ω—É—Ç)

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:** `mode="fps"`, `fps=0.5` (30 –∫–∞–¥—Ä–æ–≤), `max_dimension=720`, `audio_bitrate=64`

- 30 –∫–∞–¥—Ä–æ–≤ √ó 720p WEBP = **1.5 MB**
- –ê—É–¥–∏–æ 10 –º–∏–Ω √ó 64 kbps = **4.8 MB**
- **–ò—Ç–æ–≥–æ: ~6.3 MB** ‚úÖ (31% –ª–∏–º–∏—Ç–∞)

**–ó–∞—á–µ–º:** –î–∏–Ω–∞–º–∏—á–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ –∫–∞–¥—Ä–æ–≤ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è

#### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –õ–µ–∫—Ü–∏—è/–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è (30 –º–∏–Ω—É—Ç)

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:** `mode="total"`, `frame_count=30`, `max_dimension=1080`, `audio_bitrate=32`

- 30 –∫–∞–¥—Ä–æ–≤ √ó 1080p WEBP = **3 MB**
- –ê—É–¥–∏–æ 30 –º–∏–Ω √ó 32 kbps = **7.2 MB**
- **–ò—Ç–æ–≥–æ: ~10.2 MB** ‚úÖ (51% –ª–∏–º–∏—Ç–∞)

**–ó–∞—á–µ–º:** –°—Ç–∞—Ç–∏—á–Ω—ã–µ —Å–ª–∞–π–¥—ã + —Ä–µ—á—å, –≤—ã—Å–æ–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —Ç–µ–∫—Å—Ç–∞, –º–µ–Ω—å—à–∏–π –±–∏—Ç—Ä–µ–π—Ç –∞—É–¥–∏–æ

#### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –î–ª–∏–Ω–Ω–∞—è –ª–µ–∫—Ü–∏—è (180 –º–∏–Ω—É—Ç = 3 —á–∞—Å–∞)

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:** `mode="interval"`, `interval_sec=120` (90 –∫–∞–¥—Ä–æ–≤), `max_dimension=720`, `audio_bitrate=24`

- 90 –∫–∞–¥—Ä–æ–≤ √ó 720p WEBP = **4.5 MB**
- –ê—É–¥–∏–æ 180 –º–∏–Ω √ó 24 kbps = **32 MB** ‚ùå **–ù–ï –í–õ–ï–ó–ê–ï–¢!**

**–†–µ—à–µ–Ω–∏–µ –¥–ª—è –≤–µ—Ä—Å–∏–∏ 2.0:**

- –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ 2 —á–∞—Å—Ç–∏ –ø–æ 90 –º–∏–Ω—É—Ç
- –ò–ª–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å File API –≤–º–µ—Å—Ç–æ inline

#### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ü—Ä–∏—Ä–æ–¥–∞/–æ–±—â–∏–π –ø–ª–∞–Ω (20 –º–∏–Ω—É—Ç)

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:** `mode="total"`, `frame_count=20`, `max_dimension=480`, `audio_bitrate=32`

- 20 –∫–∞–¥—Ä–æ–≤ √ó 480p WEBP = **0.5 MB**
- –ê—É–¥–∏–æ 20 –º–∏–Ω √ó 32 kbps = **4.8 MB**
- **–ò—Ç–æ–≥–æ: ~5.3 MB** ‚úÖ (26% –ª–∏–º–∏—Ç–∞)

**–ó–∞—á–µ–º:** –û–±—â–∏–π –ø–ª–∞–Ω –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –¥–µ—Ç–∞–ª–µ–π, —ç–∫–æ–Ω–æ–º–∏—è —Ä–∞–∑–º–µ—Ä–∞

## –ü–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è

### –í–µ—Ä—Å–∏—è 1.0 (MVP) - –ß—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ–º –°–ï–ô–ß–ê–°

**–û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

- ‚úÖ –¢—Ä–∏ —Ä–µ–∂–∏–º–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–∞–¥—Ä–æ–≤: `total`, `fps`, `interval`
- ‚úÖ –ì–∏–±–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ (1080p/720p/480p), —Ñ–æ—Ä–º–∞—Ç (WEBP/JPEG), –±–∏—Ç—Ä–µ–π—Ç (64/32/24)
- ‚úÖ Dry-run: –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ë–ï–ó –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ 20 MB
- ‚úÖ In-memory –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
- ‚úÖ –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –∫ Gemini
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç (VideoAnalysisResponse)

**–£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Å GIF:**

- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `resize_image()`, –ª–æ–≥–∏–∫–∏ –∏–Ω–¥–µ–∫—Å–æ–≤
- ‚úÖ –¢–µ –∂–µ —Ä–µ–∂–∏–º—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- ‚úÖ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `media_frame_extractor`

**–õ–∏–º–∏—Ç—ã MVP:**

- –í–∏–¥–µ–æ –¥–æ ~30-60 –º–∏–Ω—É—Ç (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –±–∏—Ç—Ä–µ–π—Ç–∞ –∞—É–¥–∏–æ)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ < 20 MB –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å dry-run –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ

### –í–µ—Ä—Å–∏—è 2.0 (–ë—É–¥—É—â–µ–µ)

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª–∏–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ (>20 MB):**

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —á–∞—Å—Ç–∏
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–ø—Ä–æ–º–ø—Ç –∫–µ—à Gemini –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏)
- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –†–µ–∂–∏–º "streaming analysis" –¥–ª—è –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ

**–£–º–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**

- –ê–≤—Ç–æ–≤—ã–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º –≤–∏–¥–µ–æ (–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ)
- –î–µ—Ç–µ–∫—Ü–∏—è —Å—Ü–µ–Ω: –º–µ–Ω—å—à–µ –∫–∞–¥—Ä–æ–≤ –¥–ª—è —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö —É—á–∞—Å—Ç–∫–æ–≤
- Adaptive quality: –≤—ã—Å–æ–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–∞–¥—Ä–æ–≤ —Å —Ç–µ–∫—Å—Ç–æ–º
- –ê–Ω–∞–ª–∏–∑ –∞—É–¥–∏–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ –±–∏—Ç—Ä–µ–π—Ç–∞ (—Ä–µ—á—å vs –º—É–∑—ã–∫–∞)

**–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ä–µ–∂–∏–º—ã:**

- –†–µ–∂–∏–º `timestamps`: –∫–∞–¥—Ä—ã –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã `[30.0, 120.5, 300.0]`
- –†–µ–∂–∏–º `scenes`: –∞–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç —Å–º–µ–Ω—ã —Å—Ü–µ–Ω
- –†–µ–∂–∏–º "visual-only": –±–µ–∑ –∞—É–¥–∏–æ (—ç–∫–æ–Ω–æ–º–∏—è —Ä–∞–∑–º–µ—Ä–∞)
- –†–µ–∂–∏–º "audio-only": —Ç–æ–ª—å–∫–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è
- –†–µ–∂–∏–º "compare": –¥–≤–∞ –∫–∞–¥—Ä–∞ –¥–æ/–ø–æ—Å–ª–µ

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å File API:**

- –î–ª—è –≤–∏–¥–µ–æ >20 MB –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å File API –≤–º–µ—Å—Ç–æ inline
- –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º: –∫–∞–¥—Ä—ã inline + –∞—É–¥–∏–æ —á–µ—Ä–µ–∑ File API

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (MVP)

```bash
pip install imageio-ffmpeg pydub pillow
```

`imageio-ffmpeg` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç ffmpeg –±–∏–Ω–∞—Ä–Ω–∏–∫ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏.

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (—Å–∏—Å—Ç–µ–º–Ω—ã–π ffmpeg)

–î–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å–≤–µ–∂–µ–π –≤–µ—Ä—Å–∏–∏ ffmpeg:

**macOS:**

```bash
brew install ffmpeg
```

**Windows (—á–µ—Ä–µ–∑ winget):**

```powershell
winget install ffmpeg
```

**Windows (—á–µ—Ä–µ–∑ Chocolatey):**

```powershell
choco install ffmpeg
```

**Linux (Debian/Ubuntu):**

```bash
sudo apt-get update
sudo apt-get install ffmpeg
```

**Linux (Fedora):**

```bash
sudo dnf install ffmpeg
```

**Linux (Arch):**

```bash
sudo pacman -S ffmpeg
```

## –ò—Ç–æ–≥–∏

### –ü—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è

1. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** `imageio-ffmpeg` (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π ffmpeg) + `pydub`
2. **–§–æ—Ä–º–∞—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:**
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: **1080p WEBP quality 80**
   - –í—Å–µ–≥–¥–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ WEBP (–¥–∞–∂–µ –µ—Å–ª–∏ –∏—Å—Ç–æ—á–Ω–∏–∫ JPEG/PNG)
   - –û–ø—Ü–∏–∏: 1080p/720p/480p, WEBP/JPEG
3. **–§–æ—Ä–º–∞—Ç—ã –∞—É–¥–∏–æ:**
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: **64 kbps Vorbis mono**
   - –û–ø—Ü–∏–∏: 64/32/24 kbps
   - 24 kbps = –Ω–æ—Ä–º–∞–ª—å–Ω–æ –ø–æ–Ω—è—Ç–Ω–æ –¥–ª—è —Ä–µ—á–∏ (–Ω–µ "–Ω–µ—Ä–∞–∑–±–æ—Ä—á–∏–≤–æ"!)
4. **–†–µ–∂–∏–º—ã –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–∞–¥—Ä–æ–≤:**
   - –¢—Ä–∏ —Ä–µ–∂–∏–º–∞ –∫–∞–∫ –≤ GIF: `total`, `fps`, `interval`
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `mode="total"`, 10 –∫–∞–¥—Ä–æ–≤
5. **–õ–∏–º–∏—Ç 20 MB:**
   - –ò—Å—Ç–æ—á–Ω–∏–∫: –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Gemini `image_understanding.md`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
   - Dry-run –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
6. **In-memory –æ–±—Ä–∞–±–æ—Ç–∫–∞:**
   - –í—Å–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ BytesIO/PIL
   - –ù–∏–∫–∞–∫–∏—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (–∫–∞–∫ –≤ `gif_processor`)
7. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
   - –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `media_frame_extractor` –¥–ª—è GIF + Video
   - –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∏–∑ `gif_processor`, `image_tokens`, `audio_analyzer`
8. **API:**
   - –û–¥–∏–Ω MCP tool `analyze_video` —Å –ø–æ–ª–Ω–æ–π –≥–∏–±–∫–æ—Å—Ç—å—é
   - Dry-run –æ–ø—Ü–∏—è –¥–ª—è "–∏–≥—Ä—ã" —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
9. **Multimodal:** –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å —Å frames + audio –≤ `contents` array

### –ü–æ—á–µ–º—É —ç—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ (–∞ –Ω–µ –Ω–∞—Ç–∏–≤–Ω–æ–µ Video API)?

**–ù–∞—à –∫–µ–π—Å:** –í–∏–¥–µ–æ-–ª–µ–∫—Ü–∏–∏ 10-30 –º–∏–Ω—É—Ç —Å –≤–æ–∑–º–æ–∂–Ω—ã–º –º–µ–ª–∫–∏–º —Ç–µ–∫—Å—Ç–æ–º –Ω–∞ —Å–ª–∞–π–¥–∞—Ö.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ frames+audio:**

- –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∫–∞—á–µ—Å—Ç–≤–æ–º –∫–∞–¥—Ä–æ–≤ (—á–∏—Ç–∞–µ–º–æ—Å—Ç—å —Ç–µ–∫—Å—Ç–∞)
- –ì–∏–±–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ (WEBP, Vorbis)
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ GIF-–∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞
- –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π Video API (1 FPS, auto-resolution)

**–ö–æ–º–ø—Ä–æ–º–∏—Å—Å:** –ß—É—Ç—å —Å–ª–æ–∂–Ω–µ–µ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –Ω–æ –±–æ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è –∏ —ç–∫–æ–Ω–æ–º–∏–∏.

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–§–∞–∑–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (—É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è)**

1. ‚úÖ –ü—Ä–æ—Ä–∞–±–æ—Ç–∞–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, —Ñ–æ—Ä–º–∞—Ç—ã, –ª–∏–º–∏—Ç—ã
2. ‚è≠Ô∏è –°–æ–∑–¥–∞—Ç—å `utils/media_frame_extractor.py`
   - –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è GIF + Video
   - –¢—Ä–∏ —Ä–µ–∂–∏–º–∞: `total`, `fps`, `interval`
   - In-memory WEBP –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
   - –í–æ–∑–≤—Ä–∞—Ç metadata —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏

**–§–∞–∑–∞ 2: –ê—É–¥–∏–æ**

3. ‚è≠Ô∏è –°–æ–∑–¥–∞—Ç—å `utils/audio_extractor.py`
   - In-memory Vorbis –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è (BytesIO)
   - –¢—Ä–∏ –±–∏—Ç—Ä–µ–π—Ç–∞: 64/32/24 kbps
   - Dry-run —Ä–µ–∂–∏–º
   - –§—É–Ω–∫—Ü–∏—è `estimate_audio_size()`

**–§–∞–∑–∞ 3: MCP Tool**

4. ‚è≠Ô∏è –î–æ–±–∞–≤–∏—Ç—å `VideoAnalysisResponse` –≤ `models/analysis.py`
   - visual_summary, audio_transcription, combined_narrative
5. ‚è≠Ô∏è –°–æ–∑–¥–∞—Ç—å `tools/video_analyzer.py`
   - –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ `analyze_video()`
   - Dry-run –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ < 20 MB
   - –°–±–æ—Ä–∫–∞ multimodal –∑–∞–ø—Ä–æ—Å–∞

**–§–∞–∑–∞ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

6. ‚è≠Ô∏è –û–±–Ω–æ–≤–∏—Ç—å `requirements.txt` (imageio-ffmpeg, pydub)
7. ‚è≠Ô∏è –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –≤–∏–¥–µ–æ —Ä–∞–∑–Ω–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
8. ‚è≠Ô∏è –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ä–µ–∂–∏–º—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
9. ‚è≠Ô∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É dry-run
10. ‚è≠Ô∏è –ó–∞–º–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã vs —Ä–∞—Å—á–µ—Ç—ã

**–§–∞–∑–∞ 5: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**

11. ‚è≠Ô∏è –ù–∞–ø–∏—Å–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–ª—è docs/
12. ‚è≠Ô∏è –û–±–Ω–æ–≤–∏—Ç—å README —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –≤–∏–¥–µ–æ-–∞–Ω–∞–ª–∏–∑–∞
13. ‚è≠Ô∏è –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ —Ä–µ–∂–∏–º—ã

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

### ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ —Ñ–∞–∫—Ç—ã –æ Gemini API

#### 1. **Multimodal –∑–∞–ø—Ä–æ—Å—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è**
- Gemini API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É **—Ç–µ–∫—Å—Ç–∞ + –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π + –∞—É–¥–∏–æ** –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ `client.models.generate_content()` —Å –º–∞—Å—Å–∏–≤–æ–º `contents`
- –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã: `contents = [text_prompt, image_part, audio_part, ...]`
- **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `types.Part.from_bytes(data, mime_type)`

#### 2. **–õ–∏–º–∏—Ç 20MB –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ**
- **"The maximum total request size is 20 MB, which includes text prompts, system instructions, and all files provided inline"** (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Gemini API)
- –õ–∏–º–∏—Ç –≤–∫–ª—é—á–∞–µ—Ç: —Ç–µ–∫—Å—Ç + –ø—Ä–æ–º–ø—Ç—ã + —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ + –≤—Å–µ inline –º–µ–¥–∏–∞
- **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ–º:** —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å—Ç–∞–ª–∫–∏–≤–∞—é—Ç—Å—è —Å —ç—Ç–∏–º –ª–∏–º–∏—Ç–æ–º –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞–º–∏ >20MB

#### 3. **File API –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤**
- –î–ª—è —Ñ–∞–π–ª–æ–≤ >20MB —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `client.files.upload()`
- –ü–æ–¥—Ö–æ–¥: `f = client.files.upload(file=path)` –∑–∞—Ç–µ–º `contents=[f, prompt]`
- **–°–æ–æ–±—â–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç** —ç—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤ –≤—Å—Ç—Ä–µ—á

#### 4. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã**
- **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:** PNG, JPEG, WEBP, HEIC, HEIF
- **–ê—É–¥–∏–æ:** Vorbis (OGG), MP3 –∏ –¥—Ä—É–≥–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã
- **MIME types:** `image/jpeg`, `image/png`, `image/webp`, `audio/*`, `video/*`

### üîç –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

#### –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- Google AI for Developers: "Image understanding | Gemini API"
- Firebase AI Logic: "Supported input files and requirements"
- BytePlus: "Gemini Image Limit: Upload & Size Restrictions 2025"

#### –°–æ–æ–±—â–µ—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
- **Google AI Developers Forum:** –û–±—Å—É–∂–¥–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞–º–∏ >20MB
- **DEV Community:** –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ multimodality –≤ Gemini API
- **Bubble Forum:** –í–æ–ø—Ä–æ—Å—ã –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Gemini Pro —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏

### üéØ –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –≤–æ–∑–º–æ–∂–Ω–æ:** –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π + –∞—É–¥–∏–æ –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ
2. **–õ–∏–º–∏—Ç 20MB —Ä–µ–∞–ª—å–Ω—ã–π:** –ù—É–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ —Ä–∞–∑–º–µ—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞
3. **File API —Ä–µ—à–µ–Ω–∏–µ:** –î–ª—è –≤–∏–¥–µ–æ >30-60 –º–∏–Ω—É—Ç (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –±–∏—Ç—Ä–µ–π—Ç–∞ –∞—É–¥–∏–æ)
4. **–°–æ–æ–±—â–µ—Å—Ç–≤–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç:** –≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö

### üìä –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π

- **–î–ª—è –≤–∏–¥–µ–æ –¥–æ 30 –º–∏–Ω—É—Ç:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å inline –ø–æ–¥—Ö–æ–¥ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π (WEBP + Vorbis 32kbps)
- **–î–ª—è –≤–∏–¥–µ–æ >30 –º–∏–Ω—É—Ç:** –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å File API –¥–ª—è –∞—É–¥–∏–æ –∏–ª–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —á–∞—Å—Ç–∏
- **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å dry-run:** –î–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑–º–µ—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞
- **–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å:** 30 –∫–∞–¥—Ä–æ–≤ 1080p WEBP + 30 –º–∏–Ω—É—Ç –∞—É–¥–∏–æ 32kbps = ~10.2 MB (51% –ª–∏–º–∏—Ç–∞)

**–ò—Ç–æ–≥:** –ü–æ–¥—Ö–æ–¥ frames+audio —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π –∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ–º, –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.
